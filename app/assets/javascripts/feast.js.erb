var orgWindow;
var searchWindow;
var imgSrc;
var userId;
var userName;
var chose;
var dishId;
//start the add participation part------------------------------------------------------

function add_par(){
			  orgWindow = window;			 
			  searchWindow = window.open("http://localhost:3000/users/search", "search","left=200, top=100, height=300, width=300, menubar=yes");
			  searchWindow.focus();
		}	
				
function printUser(userIdF,userNameF,imgSrcF){
	var a  = document.createElement("a");
	a.setAttribute("href","/users/show?id="+userIdF);
	a.setAttribute("id",userIdF);
	var aText = document.createTextNode(userNameF);
	var img = document.createElement("img");
	img.setAttribute("alt","user picture");
	img.setAttribute("src",imgSrcF);
	img.setAttribute("height","100");
	img.setAttribute("width","100");
	var myDiv = document.createElement("div");
	myDiv.className = "user_block";
	//a.className = "user_block"; /* instead of the above */
	a.appendChild(img);
	var brk = document.createElement("br");
	a.appendChild(brk);
	a.appendChild(aText);
	myDiv.appendChild(a); 
	$("#par").find("table").append("<tr><td>");
	$("#par").find("td").last().append(myDiv);
	$("#par").find("tr").last().append("<td>");
	$(".user_block").last().droppable({drop: function(){
		$(this).effect( "bounce" );
		chose = "assign";
		$.get("http://localhost:3000/feasts/new", {user_id: $(this).find("a").attr("id"), dish_id: dishId, dish_name: dishName, obj: this}, null, "script");
	}});
	chose = "user";
	$.get("http://localhost:3000/feasts/new", {user_id: userId}, null, "script");	
}
		
function add_user(butt){
	userId = $(butt).data('userid');
	userName = $(butt).data('username');
	imgSrc = $(butt).data('imgsrc').image.url;
	searchWindow.close();
	orgWindow.focus();
	printUser(userId,userName,imgSrc);
	
}		
		

function remove_fields(link){
	$(link).prev("input[type=hidden]").val("1");
	$(link).parent().hide();
	$(link).hide();
}

//end the add participation part------------------------------------------------------


function addy(content){
	alert("addy");
	$("#par").after("<p>hello</p>");	
}

//start the add course part------------------------------------------------------------

function add_course(){
			  orgWindowD = window;			 
			  searchWindowD = window.open("http://localhost:3000/dishes/search_form", "search","left=200, top=100, height=330, width=330, menubar=yes");
			  searchWindowD.focus();
}	

function printDish(dishIdF,dishNameF,imgSrcF){
	var a = document.createElement("a");
	a.setAttribute("href","/dishes/show?id="+dishIdF);
	a.setAttribute("id",dishIdF+"d");
	var aText = document.createTextNode(dishNameF);
	var img = document.createElement("img");
	img.setAttribute("alt","dish picture");
	img.setAttribute("src",imgSrcF);
	img.setAttribute("height","100");
	img.setAttribute("width","100");
	var myDiv = document.createElement("div");
	myDiv.className = "dish_block";
	// a.className = "dish_block"; 
	a.appendChild(img);
	var brk = document.createElement("br");
	a.appendChild(brk);
	a.appendChild(aText);
	myDiv.appendChild(a); 
	$("#course").find("table").append("<tr><td>");
	$("#course").find("td").last().append(myDiv);
		
	//this makes the dish draggable
	
	$(".dish_block").draggable({ 
		start: function(){
	dishId = Number($(this).find("a").attr("id").slice(0,-1));
	},
	revert: true
	});	
	chose = "dish";
	$.get("http://localhost:3000/feasts/new", {dish_id: dishId}, null, "script");
}

function add_dish(butt){
	dishId = $(butt).data('dishid');
	dishName = $(butt).data('dishname');
	imgSrcD = $(butt).data('imgsrcd').image.url;
	searchWindowD.close();
	orgWindowD.focus();
	printDish(dishId,dishName,imgSrcD);
	
}		





//end the add course part------------------------------------------------------------


$(document).ready(function(){
		var t1= $("#par").data('myid');
		var t2= $("#par").data('myname');
		var t3= $("#par").data('myimage');
		printUser(t1,t2,t3);
});
